{
  "hash": "2cf53c8c8fe8fa5caef9a71d318df10d",
  "result": {
    "markdown": "---\ntitle: \"Data Management\"\n---\n\n\n::: panel-tabset\n# Statewide Data Management\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(error = FALSE,warning = FALSE,message = FALSE)\n\nbns <- readRDS(here::here(\"./raw_data/bns3_statewide_clean.rds\"))\n\n\n\nlibrary(stringr)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\n\nbns$Cohort <- \"Statewide\"\n\n\n# Age ----\n# No cleaning needed\n\n\n# Ethnicity -----\n\nbns$eth_hispanic2 <- recode(bns$eth_hispanic, \"1\" = \"Hispanic\", \"0\" = \"Non Hispanic\")\n\n\n\n\n# academic year -----\nbns$academic_level <- recode(bns$q15, \"Freshman (0-29 semester units or 0-44 quarter units)\" = \"Freshman\",\n                            \"Sophomore (30-59 semester units or 45-89 quarter units)\" = \"Sophomore\",\n                            \"Junior (60-89 semester units or 90-134 quarter units)\" = \"Junior\",\n                            \"Senior (90+ semester units or 135+ quarter units)\" = \"Senior\",\n                            \"None of these apply\" = \"Other\") %>% factor(order = FALSE)\n\n\n# 2 item-Food Insecurity ( 1 = Food Insecure): food_insecure_2item\n\n\n# Gender -----\n\nbns$gender <- case_when(bns$q7 == \"Man\" ~ \"Male\", bns$q7 == \"Woman\" ~ \"Female\") %>% factor(order = FALSE)\n\n\n\n# Confidence in cooking Yes Vs No ------\n# How confident are you that you can use basic cooking skills, like cutting fruits and vegetables, measuring out ingredients, or following a recipe?\n\nbns$cooking_confident <- recode(bns$q82_2, \"Not at all confident\" = \"No\", \"Not very confident\" = \"No\", \n                                \"Neutral\" = \"No\",\n                                \"Somewhat confident\" = \"Yes\", \"Very Confident\" = \"Yes\") %>% factor(order = FALSE)\n\n\n\n# Living With Family Vs No -----\n\nbns$living_with_family <- case_when(grepl(\"I live with parents or other relatives, paying rent with my own money|I live with parents or other relatives, not paying rent with my own money\", bns$q25, fixed = FALSE, ignore.case = TRUE) ~ \"Yes\",\n                                    grepl(\"I live in university housing or residence halls|I rent an apartment or house with roommates|I rent an apartment or house without roommates|I own my own home|I live in transitional housing or a halfway home|I am temporarily living with friends or relatives without permanent housing|I am currently living at an outdoor location|Other|I live in a sorority or fraternity house|I am temporarily living in a homeless shelter without permanent housing\", \n                                          bns$q25, fixed = FALSE, ignore.case = TRUE) ~ \"No\") %>% factor(order = FALSE)\n\n\n\n\n\n# Total Hours including paid, unpaid, unit hours and caregiving hours ------\n\nbns$unit_hours <- 3*(bns$q18)\n\nbns$weekly_hours <- bns %>% select(unit_hours, paid_work_hours, unpaid_work_hours, caregiving_hours) %>% rowSums(na.rm = FALSE)\n\nbns$weekly_hours_in_tens <- bns$weekly_hours/10\n\nbns <- rename(bns, units = q18)\n\n\n\n# Health Conscious (q76_9) -----\n# I do not think about my eating/food habits\n\nbns$health_conscious <- recode(bns$q76_9, \"Strongly disagree\" = \"Yes\", \"Disagree\" = \"Yes\",\n                               \"Neither agree nor disagree\" = \"No\", \"Agree\" = \"No\", \"Strongly agree\" = \"No\") %>% factor(order = FALSE)\n\n\n\n\n\n# CalFresh Variables ----\n\n# Create temporary CalFresh variable\nbns <- bns %>% mutate(current_calfresh_temp = case_when(grepl(\"Currently use as a college student\", q46_1) ~ \"CalFresh\",\n                                                          grepl(\"Used it in the past as a college student\", q46_1) ~ \"No CalFresh\",\n                                                          grepl(\"Heard of it, but never used it\", q46_1) ~ \"No CalFresh\",\n                                                          grepl(\"Never heard of it\", q46_1) ~ \"No CalFresh\",\n                                                          grepl(\"Used it before attending college\", q46_1) ~ \"No CalFresh\"))\n\n\n\n# Create  calfresh variable (https://www.cdss.ca.gov/calfreshoutreach/res/toolkit/quickreference/regulationquickreference_e_students.pdf)\n# Age and units don't actually matter. if they are between the ages of 18 and 49, and taking more than 6 units, a person is classified as a student and must meet a work exemption (such as EOP). \n# However, if they are older than 49 or taking less than 6 units, they are not classified as a student and can still apply to calFresh as a non student. \n# Both a non student and a student need to meet the same income and citizenship requirements. A student differs from a non student by needing to meet a work exemption which all students are EOP and meet an exemption. \n\n\n\nbns$calfresh3 <- case_when(bns$current_calfresh_temp == \"CalFresh\" ~ \"CalFresh\", \n                               bns$current_calfresh_temp == \"No CalFresh\" & bns$calfresh_eligible == 1 ~ \"No CalFresh but Likely Eligible\",\n                               bns$current_calfresh_temp == \"No CalFresh\" & bns$calfresh_eligible == 0 ~ \"Likely Not Eligible\") \n\n\nbns$calfresh3 <- factor(bns$calfresh3, levels = c(\"CalFresh\", \"No CalFresh but Likely Eligible\", \"Likely Not Eligible\"))\n\n\n\n\n\n# Income Eligible Group\n\n\nbns <- bns %>% mutate(m_income = as.numeric(monthly_hh_income, na.rm = TRUE),\n                      Income_Eligible = ifelse(((household_size == 1 & m_income < 3) |\n                                                          (household_size == 2 & m_income < 4) |\n                                                          (household_size == 3 & m_income < 5) |\n                                                          (household_size == 4 & m_income < 6) |\n                                                          (household_size == 5 & m_income < 7) |\n                                                          (household_size == 6 & m_income < 8) |\n                                                          (household_size == 7 & m_income < 9) |\n                                                          (household_size == 8 & m_income < 10)), \"Yes\", \"No\"))\n\n\n\n\n\n\n\n# Fruit/Vegetables ----\n\nbns$fruits <- bns$q77\n\nbns$fruits3 <- recode(bns$q77, \"0 servings per day\" = \"0\", \n                      \"1-2 servings per day\" = \"1-2\",\n                      \"3-4 servings per day\" = \"3 or more\",\n                      \"5 or more servings per day\" = \"3 or more\") %>% factor(order = FALSE)\n\n\n\nbns$fruits2 <- recode(bns$q77, \"0 servings per day\" = \"2 or less\", \n                      \"1-2 servings per day\" = \"2 or less\",\n                      \"3-4 servings per day\" = \"3 or more\",\n                      \"5 or more servings per day\" = \"3 or more\")\n\nbns$q77 <- recode(bns$q77, \"0 servings per day\" = \"0\", \n                   \"1-2 servings per day\" = \"1-2\",\n                   \"3-4 servings per day\" = \"3-4\",\n                   \"5 or more servings per day\" = \"5 or more\")\n\n\n\n\n# SSB ----\n\nbns$ssb <- bns$q78\n\nbns$ssb5 <- recode(bns$q78, \"Zero\" = \"Zero\",\n                    \"1-8 ounces\" = \"1-8 ounces\", \n                    \"9-16 ounces\" = \"9-16 ounces\",  \n                    \"17-24 ounces\" =  \"17-24 ounces\", \n                    \"25-36 ounces\" = \"25-36 ounces\",\n                    \"37-48 ounces\" = \"37 or more ounces\", \n                    \"49-56 ounces\" =  \"37 or more ounces\", \n                    \"57-64 ounces\" = \"37 or more ounces\", \n                    \"64 ounces or more\" = \"37 or more ounces\")\n\nbns$ssb4 <- recode(bns$q78, \"Zero\" = \"Zero\",\n                   \"1-8 ounces\" = \"1-8 ounces\", \n                   \"9-16 ounces\" = \"9-16 ounces\",  \n                   \"17-24 ounces\" =  \"17-24 ounces\", \n                   \"25-36 ounces\" = \"25 or more ounces\",\n                   \"37-48 ounces\" = \"25 or more ounces\", \n                   \"49-56 ounces\" =  \"25 or more ounces\", \n                   \"57-64 ounces\" = \"25 or more ounces\", \n                   \"64 ounces or more\" = \"25 or more ounces\")\n\n# table(bns$ssb4, useNA = \"always\")\n\nbns$ssb_numeric <- recode(bns$q78, \"Zero\" = 0,\n                   \"1-8 ounces\" = 4.5, \n                   \"9-16 ounces\" = 12.5,  \n                   \"17-24 ounces\" =  20.5, \n                   \"25-36 ounces\" = 30.5,\n                   \"37-48 ounces\" = 42.5, \n                   \"49-56 ounces\" =  52.5, \n                   \"57-64 ounces\" = 60.5, \n                   \"64 ounces or more\" = 64)\n\n# table(bns$ssb_numeric, useNA = \"always\")\n\n\n\n\n\n# Fast Food ----\n\n\nbns$ff4 <- recode(bns$q79, \"Zero\" = \"Zero times per week\", \n                             \"1-2 times per week\" = \"1-2 times\", \n                             \"3-4 times per week\" = \"3-4 times\",\n                             \"5-6 times per week\" = \"5 or more times\",\n                             \"7-8 times per week\" = \"5 or more times\", \n                             \"9-10 times per week\" = \"5 or more times\", \n                             \"11 times or more per week\" = \"5 or more times\")\n\n# table(bns$ff5, useNA = \"always\")\n\nbns$ff_numeric <- recode(bns$q79, \"Zero\" = 0, \n                         \"1-2 times per week\" = 1.5, \n                         \"3-4 times per week\" = 3.5,\n                         \"5-6 times per week\" = 5.5,\n                         \"7-8 times per week\" = 7.5, \n                         \"9-10 times per week\" = 9.5, \n                         \"11 times or more per week\" = 11)\n\n# table(bns$ff_numeric, useNA = \"always\")\n\n\n\n\n\n# Kitchen Access ----\n# I do not regularly have access to a kitchen where I can prepare meals.\n\nbns$kitchen_access <- recode(bns$q76_1, \"Strongly disagree\" = \"Yes\", \"Disagree\" = \"Yes\",\n                               \"Neither agree nor disagree\" = \"No\", \"Agree\" = \"No\", \"Strongly agree\" = \"No\") %>% factor(order = FALSE)\n\n\n# Storage Access ----\n# I have a secure place to store fresh food and pantry items.\n\nbns$storage_access <- recode(bns$q76_2, \"Strongly disagree\" = \"No\", \"Disagree\" = \"No\", \"Neither agree nor disagree\" = \"No\", \n                             \"Agree\" = \"Yes\", \"Strongly agree\" = \"Yes\") %>% factor(order = FALSE)\n\n\n# Room for storage ----\n#  I do not have enough room to store food items.\n\nbns$storage_room <- recode(bns$q76_3, \"Strongly disagree\" = \"Yes\", \"Disagree\" = \"Yes\",\n                           \"Neither agree nor disagree\" = \"No\", \"Agree\" = \"No\", \"Strongly agree\" = \"No\") %>% factor(order = FALSE)\n\n\n\n\n\n# School (for FNCE and/or CFHL Poster)\n# Used to compare campuses that have CFHL (1) vs don't have CFHL (0)\n\nbns$campus_CFHL <- case_when(bns$school == \"Cal State San Bernardino\" ~ \"Campus has CFHL\",\n                             bns$school == \"Sacramento State\" ~ \"Campus has CFHL\",\n                             bns$school == \"CSU Dominguez Hills\"  ~ \"Campus has CFHL\", \n                             bns$school == \"CSU Bakersfield\" ~ \"Campus DOES NOT have CFHL\",\n                             bns$school == \"San Francisco State\" ~ \"Campus DOES NOT have CFHL\",\n                             bns$school == \"Cal State LA\" ~ \"Campus DOES NOT have CFHL\") \n# table(bns$campus_CFHL, bns$school, useNA = \"always\")\n\n\n\n# Physical activity indicator\n\nbns <- bns %>% mutate_at(c('q83_1', 'q83_2', 'q83_3'), recode,\n                         \"0 days\" = 0, \"1 day\" = 1, \"2 days\" = 2, \"3 days\" = 3, \"4 days\" = 4, \"5 days\" = 5, \"6 days\" = 6, \"7 days\" = 7)\n\nphysical_act_temp <- bns %>% select(q83_1, q83_2, q83_3) %>% rowSums()\n\n\nbns$physical_activity <- ifelse(physical_act_temp >= 1, \"Yes\", \"No\")\n\n\n\n\n\n# Select variables of interest\n\nbns_variables <- bns %>%  select(calfresh3, race_eth, eth_PNTA, eth_hispanic, gender, q7, age, cooking_confident, q82_2,living_with_family, q25, food_insecure_2item, weekly_hours,                        health_conscious, q76_9, kitchen_access, q76_1, storage_access, q76_2, storage_room, q76_3, Cohort, campus_CFHL, ff_numeric, ssb_numeric, q78, q79, fruits3, q77, units, q38, q39, household_size, monthly_hh_income, paid_work_hours, unpaid_work_hours, unit_hours, caregiving_hours, q64, q65, school, q46_1, calfresh_eligible, housing_insecure, homelessness_year, homelessness_month, household_size, firstgen, physical_activity, q83_1, q83_2, q83_3, academic_level, Income_Eligible, q26, q27, q28, q29, q30, q31, q32, q33)\n```\n:::\n\n\n# Pilot 2 Data Management\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(here::here(\"./raw_data/BNSp2_clean.Rdata\"))\n\n\nBNSp2b$Cohort <- \"Pilot 2\"\n\n\n# Age ----\n# No cleaning needed\n\n\n\n# Ethnicity -----\n\nBNSp2b$ethn_hispanic2 <- recode(BNSp2b$eth_hispanic, \"1\" = \"Hispanic\", \"0\" = \"Non Hispanic\")\n# table(BNSp2b$eth_hispanic2, BNSp2b$eth_hispanic, useNA = \"always\")\n\n\n# rename to be able to use grep function on the rest of the \"eth_\" variables\nBNSp2b <- BNSp2b %>% rename(\"ethn_hispanic\" = \"eth_hispanic\" )\n\n\n# Create eth_PNTA \n# If anyone did not get to this part of the survey, they would have been dropped since this is one of the first questions, hence all the NA values are from \"Prefer not to answer responses\"\n# All eth variables have the same amount of NA values so using any \"eth_\" variable would work to create the eth_PNTA variable\n\nBNSp2b$eth_PNTA <- ifelse(is.na(BNSp2b$eth_white), 1, 0)\n#table(BNSp2b$eth_PNTA, useNA = \"always\")\n\n\n\n\n# Get the column names that start with 'eth_'\neth_columns <- grep(\"eth_\", names(BNSp2b), value = TRUE)\n\n# Update 'NA' values to 0 (not selected) in eth_columns\nBNSp2b <- BNSp2b %>%\n  mutate(across(all_of(eth_columns), ~ifelse(is.na(.), 0, .)))\n# table(BNSp2b$eth_african_amer, useNA = \"always\")\n\n\n# rename back to eth_hispanic\n\nBNSp2b <- BNSp2b %>% rename(\"eth_hispanic\" = \"ethn_hispanic\" )\n\nBNSp2b <- BNSp2b %>% rename(\"eth_hispanic2\" = \"ethn_hispanic2\" )\n\n\n\n\n# Count number of people who selected multiple races (not including PNTA and hispanic)\n\nBNSp2b$race_total_count <- BNSp2b %>% select(contains(\"eth_\"), -eth_PNTA, -eth_hispanic, -eth_hispanic2) %>% rowSums()\n\n\n\nBNSp2b$race_eth <- case_when(BNSp2b$eth_hispanic == 1 & BNSp2b$eth_PNTA == 1 & BNSp2b$race_total_count == 0 ~ \"Hispanic Prefer Not to Answer Race\", \n                                 BNSp2b$eth_hispanic == 1 & BNSp2b$eth_white == 1 & BNSp2b$eth_PNTA == 0 & BNSp2b$race_total_count == 1 ~ \"Hispanic White\",\n                                 BNSp2b$eth_hispanic == 0 & BNSp2b$eth_white == 1 &  BNSp2b$eth_PNTA == 0 & BNSp2b$race_total_count == 1 ~ \"Non Hispanic White\",\n                                 BNSp2b$eth_hispanic == 0 & BNSp2b$eth_african_amer == 1 & BNSp2b$eth_PNTA == 0 & BNSp2b$race_total_count == 1 ~ \"Non Hispanic African American\",\n                                 BNSp2b$eth_hispanic == 0 & (BNSp2b$eth_japanese == 1 | BNSp2b$eth_korean == 1 | BNSp2b$eth_asian_indian == 1| BNSp2b$eth_other_asian == 1 |  \n                                                                   BNSp2b$eth_vietnamese == 1 | BNSp2b$eth_chinese == 1 | BNSp2b$eth_filipino == 1) & \n                                   BNSp2b$eth_PNTA == 0 & BNSp2b$race_total_count == 1 ~ \"Non Hispanic Asian\",\n                                 TRUE ~ \"Other/Unknown\")\n# BNSp2b %>% select(contains(\"eth_\"), race_eth) %>% group_by_all() %>% summarize(count=n()) %>% print(n=100)\n\n\n\n\n\n# 2 item-Food Insecurity ( 1 = Food Insecure): food_insecure_2item\n\n\n\n\n# Gender -----\n\nBNSp2b$gender <- case_when(BNSp2b$q7 == \"Man\" ~ \"Male\", BNSp2b$q7 == \"Woman\" ~ \"Female\") %>% factor(order = FALSE)\n\n\n\n# Confidence in cooking Yes Vs No ------\n# How confident are you that you can use basic cooking skills, like cutting fruits and vegetables, measuring out ingredients, or following a recipe?\n\nBNSp2b$cooking_confident <- recode(BNSp2b$q82_2, \"Not at all confident\" = \"No\", \"Not very confident\" = \"No\", \n                                \"Neutral\" = \"No\",\n                                \"Somewhat confident\" = \"Yes\", \"Very confident\" = \"Yes\") %>% factor(order = FALSE)\n\n\n\n\n\n# Living With Family Vs No -----\n\nBNSp2b$living_with_family <- case_when(grepl(\"I live with parents or other relatives, paying rent with my own money|I live with parents or other relatives, not paying rent with my own money\", BNSp2b$q25, fixed = FALSE, ignore.case = TRUE) ~ \"Yes\",\n                                    grepl(\"I live in university housing or residence halls|I rent an apartment or house with roommates|I rent an apartment or house without roommates|I own my own home|I live in transitional housing or a halfway home|I am temporarily living with friends or relatives, without permanent housing|I am currently living at an outdoor location|Other|I live in a sorority or fraternity house|I am temporarily living in a homeless shelter without permanent housing\", \n                                          BNSp2b$q25, fixed = FALSE, ignore.case = TRUE) ~ \"No\") %>% factor(order = FALSE)\n\n# table(BNSp2b$q25, BNSp2b$living_with_family, useNA = \"always\")\n\n\n\n# Total Hours including paid, unpaid, unit hours and caregiving hours ------\n\nBNSp2b$units <- recode(BNSp2b$q18, \"22+\" = \"22\") %>% as.numeric(BNSp2b$q18, na.rm = TRUE)\nBNSp2b$paid_work_hours <-  recode(BNSp2b$q19, \"41+\" = \"41\") %>% as.numeric(BNSp2b$q19, na.rm = TRUE)\nBNSp2b$unpaid_work_hours <- recode(BNSp2b$q21, \"41+\" = \"41\") %>% as.numeric(BNSp2b$q21, na.rm = TRUE)\nBNSp2b$caregiving_hours <-recode(BNSp2b$q22, \"41+\" = \"41\") %>% as.numeric(BNSp2b$q22, na.rm = TRUE)\n\n\nBNSp2b$unit_hours <- 3*(BNSp2b$units)\n\nBNSp2b$weekly_hours <- BNSp2b %>% select(unit_hours, paid_work_hours, unpaid_work_hours, caregiving_hours) %>% rowSums(na.rm = FALSE)\n\nBNSp2b$weekly_hours_in_tens <- BNSp2b$weekly_hours/10\n\n\n# Health Conscious (q76_9) -----\n# I do not think about my eating/food habits\n\nBNSp2b$health_conscious <- recode(BNSp2b$q76_9, \"Strongly disagree\" = \"Yes\", \"Disagree\" = \"Yes\",\n                               \"Neither agree nor disagree\" = \"No\", \"Agree\" = \"No\", \"Strongly agree\" = \"No\") %>% factor(order = FALSE)\n# table(BNSp2b$health_conscious, useNA = \"always\")\n\n\n\n\n# CalFresh Variables ----\n\n# Create temporary CalFresh variable\nBNSp2b <- BNSp2b %>% mutate(current_calfresh_temp = case_when(grepl(\"Currently use as a college student\", q46_1) ~ \"CalFresh\",\n                                                        grepl(\"Used it in the past as a college student\", q46_1) ~ \"No CalFresh\",\n                                                        grepl(\"Heard of it, but never used it\", q46_1) ~ \"No CalFresh\",\n                                                        grepl(\"Never heard of it\", q46_1) ~ \"No CalFresh\",\n                                                        grepl(\"Used it before attending college\", q46_1) ~ \"No CalFresh\"))\n\n\n\n# Create a 3 level CalFresh variable\nBNSp2b$calfresh3 <- case_when(BNSp2b$current_calfresh_temp == \"CalFresh\" ~ \"CalFresh\", \n                           BNSp2b$current_calfresh_temp == \"No CalFresh\" & BNSp2b$calfresh_eligible == \"Yes\" ~ \"No CalFresh but Likely Eligible\",\n                           BNSp2b$current_calfresh_temp == \"No CalFresh\" & BNSp2b$calfresh_eligible == \"No\" ~ \"Likely Not Eligible\") \n\n\n\n\n\n# Income Only Eligible\n\nBNSp2b <- BNSp2b %>% mutate(m_income = as.numeric(monthly_hh_income, na.rm = TRUE),\n                            Income_Eligible = ifelse((q38 == \"Yes\" | q39 == \"Yes\") & \n                                                             ((household_size == 1 & m_income < 3) |\n                                                                (household_size == 2 & m_income < 4) |\n                                                                (household_size == 3 & m_income < 5) |\n                                                                (household_size == 4 & m_income < 6) |\n                                                                (household_size == 5 & m_income < 7) |\n                                                                (household_size == 6 & m_income < 8) |\n                                                                (household_size == 7 & m_income < 9) |\n                                                                (household_size == 8 & m_income < 10)), \"Yes\", \"No\"))\n\n\n\n\n\n\n# Fruit/Vegetables ----\n\nBNSp2b$fruits <- BNSp2b$fruit_veg_serv_daily\n\nBNSp2b$fruits3 <- recode(BNSp2b$fruits, \"0\" = \"0\", \n                      \"1-2\" = \"1-2\",\n                      \"3-4\" = \"3 or more\",\n                      \"5+\" = \"3 or more\") %>% factor(order = FALSE)\n\n\n\n# Keep in line with statewide data\nBNSp2b$q77 <- recode(BNSp2b$fruits, \"0\" = \"0\", \n                  \"1-2\" = \"1-2\",\n                  \"3-4\" = \"3-4\",\n                  \"5+\" = \"5 or more\")\n\n\n\n\n# SSB ----\n\nBNSp2b$ssb <- BNSp2b$sugar_drinks_ounces_daily\n\n\nBNSp2b$ssb_numeric <- recode(BNSp2b$ssb, \"0\" = 0,\n                          \"1-8\" = 4.5, \n                          \"9-16\" = 12.5,  \n                          \"17-24\" =  20.5, \n                          \"25-36\" = 30.5,\n                          \"37-48\" = 42.5, \n                          \"49-56\" =  52.5, \n                          \"57-64\" = 60.5, \n                          \"64+\" = 64)\n# table(BNSp2b$ssb_numeric, useNA = \"always\")\n\n# Keep in line with statewide data\nBNSp2b$q78 <- recode(BNSp2b$ssb, \"0\" = \"Zero\",\n                     \"1-8\" = \"1-8 ounces\", \n                     \"9-16\" = \"9-16 ounces\",  \n                     \"17-24\" =  \"17-24 ounces\", \n                     \"25-36\" = \"25-36 ounces\",\n                     \"37-48\" = \"37-48 ounces\", \n                     \"49-56\" =  \"49-56 ounces\", \n                     \"57-64\" = \"57-64 ounces\", \n                     \"64+\" = \"64 ounces or more\")\n  \n\n\n# Fast Food ----\n\nBNSp2b$q79 <- BNSp2b$eating_out_weekly\n\n\nBNSp2b$ff_numeric <- recode(BNSp2b$q79, \"0\" = 0, \n                         \"1-2\" = 1.5, \n                         \"3-4\" = 3.5,\n                         \"5-6\" = 5.5,\n                         \"7-8\" = 7.5, \n                         \"9-10\" = 9.5, \n                         \"11+\" = 11)\n\n# table(BNSp2b$ff_numeric, useNA = \"always\")\n\n\n\n\n\n# Kitchen Access ----\n# I do not regularly have access to a kitchen where I can prepare meals.\n\nBNSp2b$kitchen_access <- recode(BNSp2b$q76_1, \"Strongly disagree\" = \"Yes\", \"Disagree\" = \"Yes\",\n                             \"Neither agree nor disagree\" = \"No\", \"Agree\" = \"No\", \"Strongly agree\" = \"No\") %>% factor(order = FALSE)\n\n\n# Storage Access ----\n# I have a secure place to store fresh food and pantry items.\n\nBNSp2b$storage_access <- recode(BNSp2b$q76_2, \"Strongly disagree\" = \"No\", \"Disagree\" = \"No\", \"Neither agree nor disagree\" = \"No\", \n                             \"Agree\" = \"Yes\", \"Strongly agree\" = \"Yes\") %>% factor(order = FALSE)\n\n\n# Room for storage ----\n#  I do not have enough room to store food items.\n\nBNSp2b$storage_room <- recode(BNSp2b$q76_3, \"Strongly disagree\" = \"Yes\", \"Disagree\" = \"Yes\",\n                           \"Neither agree nor disagree\" = \"No\", \"Agree\" = \"No\", \"Strongly agree\" = \"No\") %>% factor(order = FALSE)\n\n\n\n\n\n# School (for FNCE and/or CFHL Poster)\n# Used to compare campuses that have CFHL (1) vs don't have CFHL (0)\n\nBNSp2b$campus_CFHL <- \"Campus has CFHL\" # All the campuses in Pilot 2 have CFHL (Double check if they had CFHL at the time of the survey)\n\n\n\n# Physical activity indicator\n\n\nphysical_act_temp <- BNSp2b %>% select(moderate_exercise_past_week, vigorous_exercise_past_week, strength_training_past_week) %>% rowSums()\n\n\nBNSp2b$physical_activity <- ifelse(physical_act_temp >= 1, \"Yes\", \"No\")\n\n\n# Rename physical activity variables to match statewide names\n\nBNSp2b <- rename(BNSp2b, q83_1 = moderate_exercise_past_week,\n                 q83_2 = vigorous_exercise_past_week, \n                 q83_3 = strength_training_past_week)\n\n\n# Academic level\n\nBNSp2b$academic_level <- recode(BNSp2b$academic_level, \"Junior (60-89 semester units)\" = \"Junior\", \"Senior (90+ semester units)\" = \"Senior\")\n\n\n# Filter out people on a meal plan\n\nBNSp2b <- BNSp2b %>% filter((meals_per_week_mp != \"11+\") %>% tidyr::replace_na(TRUE))\n\n\nBNSp2b <- BNSp2b %>% select(calfresh3, race_eth, eth_PNTA, eth_hispanic, gender, q7, age, cooking_confident, q82_2,living_with_family, q25, food_insecure_2item, weekly_hours, \n                            health_conscious, q76_9, kitchen_access, q76_1, storage_access, q76_2, storage_room, q76_3, Cohort, campus_CFHL,\n                            ff_numeric, ssb_numeric, q78, q79, fruits3, q77, units, q38, q39, household_size, monthly_hh_income, paid_work_hours, \n                            unpaid_work_hours, unit_hours, caregiving_hours, q64, q65, school, q46_1, calfresh_eligible, housing_insecure, homelessness_year, \n                            homelessness_month, household_size, firstgen, physical_activity, q83_1, q83_2, q83_3, academic_level, Income_Eligible,\n                            q26, q27, q28, q29, q30, q31, q32, q33)\n```\n:::\n\n\n# Combine Data Sets\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Combine data sets\nbns_combined <- rbind(bns_variables, BNSp2b)\n\n\nrm(bns_variables)\n\n\n# Additional data management for combined data set (Used for imputations)\n\n# Group other genders into its own category (Some Wording differed between data sets and there were very few other responses)\nbns_combined$q7 <- case_when(bns_combined$q7 == \"Man\" ~ \"Male\", bns_combined$q7 == \"Woman\" ~ \"Female\",\n                             grepl(\"Gender\", bns_combined$q7, fixed = FALSE) ~ \"Other\") %>% factor(order = FALSE)\n\n\n# Fix Capitalization\nbns_combined$q82_2 <- recode(bns_combined$q82_2, \"Very confident\" = \"Very Confident\")\n\n\n# Fix slight word/punctuation changes\nbns_combined$q25 <- recode(bns_combined$q25, \"I am temporarily living with friends or relatives, without permanent housing (couch surfing)\" = \"I am temporarily living with friends or relatives without permanent housing (i.e. couch surfing)\",\n                           \"Other\" = \"Other (Please specify):\", \"I am currently living at an outdoor location, abandoned building, car, or other area not meant for regular housing, without permanent housing\" = \"I am currently living at an outdoor location, abandoned building, car, or other area not meant for regular housing without permanent housing\")\n\n\n# Fix slight word changes\n bns_combined$q79 <- recode(bns_combined$q79, \"0\" = \"Zero\", \n                            \"1-2\" = \"1-2 times per week\", \n                            \"3-4\" = \"3-4 times per week\",\n                            \"5-6\" = \"5-6 times per week\",\n                            \"7-8\" = \"7-8 times per week\", \n                            \"9-10\" = \"9-10 times per week\", \n                            \"11+\" = \"11 times or more per week\")\n \n \n# Remove NAs from citizenship questions from skip logic (to use in imputations)\n\nbns_combined$q39 <- ifelse(bns_combined$q38 == \"Yes\", \"Citizen\", as.factor(bns_combined$q39))\nbns_combined$q39 <- recode(bns_combined$q39, \"1\" = \"Yes\", \"2\" = \"No\") %>% factor(order = FALSE)\n\n\n# Group household income into 6 levels\nbns_combined$monthly_hh_income <- recode(bns_combined$monthly_hh_income,\n         \"Less than $150\" = \"Very Low\", \"$150 or less\" = \"Very Low\",\n         \"$151-$2,148\" = \"Low\", \"$151-$2,082\" = \"Low\",\n         \"$2,149-$2,904\" = \"Moderate\", \"$2,083-$2,820\" = \"Moderate\",\n         \"$2,905-$3,660\" = \"High\", \"$2,821-$3,556\" = \"High\",\n         \"$3,661-$4,418\" = \"Very High\", \"$3,557-$4,292\" = \"Very High\",\n         .default = \"Very High\")\n  \n\n\n# Fix responses with low sample sizes in q25 (for imputations)\nbns_combined$q25 <- recode(bns_combined$q25, \"I am temporarily living in a homeless shelter without permanent housing\" = \"Homeless\",\n                           \"I am currently living at an outdoor location, abandoned building, car, or other area not meant for regular housing without permanent housing\" = \"Homeless\")\n\n\n# Fix responses in calfresh_eligible_new\nbns_combined$calfresh_eligible <- recode(bns_combined$calfresh_eligible, \"0\" = \"No\", \"1\" = \"Yes\") %>% factor(order = FALSE)\n\n\n\n# Fix class of some variables:\n\nbns_combined$q25 <- factor(bns_combined$q25, order = FALSE)\nbns_combined$units <- as.numeric(bns_combined$units, na.rm = TRUE)\nbns_combined$Cohort <- factor(bns_combined$Cohort, order = FALSE)\nbns_combined$school <- factor(bns_combined$school, order = FALSE)\nbns_combined$q38 <- factor(bns_combined$q38, order = FALSE)\nbns_combined$physical_activity <- factor(bns_combined$physical_activity, order = FALSE)\n\n\n\n# Change Reference values\n\n\nbns_combined$race_eth <- factor(bns_combined$race_eth, order = FALSE) %>% relevel(bns_combined$race_eth, ref = \"Non Hispanic White\")\n\nbns_combined$food_insecure_2item <- recode(bns_combined$food_insecure_2item, \"0\" = \"No\", \"1\" = \"Yes\") \nbns_combined$food_insecure_2item <- factor(bns_combined$food_insecure_2item, order = FALSE) %>% relevel(bns_combined$food_insecure_2item, ref = \"Yes\")\n\nbns_combined$health_conscious <- factor(bns_combined$health_conscious, order = FALSE) %>% relevel(bns_combined$health_conscious, ref = \"No\")\n\nbns_combined$kitchen_access <- factor(bns_combined$kitchen_access, order = FALSE) %>% relevel(bns_combined$kitchen_access, ref = \"No\")\n\nbns_combined$storage_access <- factor(bns_combined$storage_access, order = FALSE) %>% relevel(bns_combined$storage_access, ref = \"No\")\n\nbns_combined$storage_room <- factor(bns_combined$storage_room, order = FALSE) %>% relevel(bns_combined$storage_room, ref = \"No\")\n\n\n\n\n# Create dependent variable forms\n\nbns_combined$log_ff <- log(0.10 + bns_combined$ff_numeric)\n\nbns_combined$log_ssb <- log(0.10 + bns_combined$ssb_numeric)\n\nbns_combined$q77_one_vs_zero <- case_when(bns_combined$q77 == \"0\" ~ \"0\", bns_combined$q77 == \"1-2\" ~ \"1-2\")  %>% factor(order = FALSE)\n\n\nbns_combined$q77_one_vs_three_or_more <- case_when(bns_combined$q77 == \"3-4\" ~ \"3 or more\", bns_combined$q77 == \"5 or more\" ~ \"3 or more\",\n                                                   bns_combined$q77 == \"1-2\" ~ \"1-2\")  %>% factor(order = FALSE)\n\n\nbns_combined$q77_one_vs_three <- case_when(bns_combined$q77 == \"3-4\" ~ \"3-4\", bns_combined$q77 == \"1-2\" ~ \"1-2\")  %>% factor(order = FALSE)\n\n\nbns_combined$q77_five_vs_three <- case_when(bns_combined$q77 == \"3-4\" ~ \"3-4\", bns_combined$q77 == \"5 or more\" ~ \"5+\")  %>% factor(order = FALSE)\n\n\n\n# Change numeric variables to increments of 10\n\nbns_combined$paid_work_hours_tens <- (bns_combined$paid_work_hours)/10\nbns_combined$unpaid_work_hours_tens <- (bns_combined$unpaid_work_hours)/10\nbns_combined$caregiving_hours_tens <- (bns_combined$caregiving_hours)/10\nbns_combined$units_four <- (bns_combined$units)/4\n\n\n\n\n# Change PNTA ethnicity responses to missing for imputations\n\nbns_combined$race_eth <- case_when(bns_combined$eth_PNTA == \"1\" ~ NA, TRUE ~ as.factor(bns_combined$race_eth)) %>% droplevels()\n\n\n# Change fast food to categorical\nbns_combined$ff_cat <- recode(bns_combined$ff_numeric, \"0\" = \"Zero\",\n                                       \"1.5\" = \"1-2 times per week\", \n                                       \"3.5\" = \"3-4 times per week\",\n                                       .default =  \"5 or more times per week\") %>% factor(order = FALSE,\n                                                                                          levels = c(\"Zero\", \"1-2 times per week\", \"3-4 times per week\",\"5 or more times per week\" ))\n\n\n# Change SSB to categorical\nbns_combined$ssb_cat <- recode(bns_combined$ssb_numeric, \"0\" = \"Zero\",\n                                        \"4.5\" = \"1-8 ounces\", \n                                        \"12.5\" = \"9-16 ounces\",  \n                                        .default = \"17 or more ounces\")  %>% factor(order = FALSE, \n                                                                                    levels = c(\"Zero\", \"1-8 ounces\", \"9-16 ounces\", \"17 or more ounces\"))\n\n\n# Convert \"Other\" academic year Responses to NA (Small sample size affects imputations and everyone surveyed should fall into one of the 4 categories)\n\nbns_combined$academic_level <- na_if(bns_combined$academic_level, \"Other\") %>% droplevels()\n\n\n# Drop non males and females and drop non citizens/non lawful permanent residents\nbns_combined <- bns_combined %>% filter((q7 != \"Other\") %>% replace_na(TRUE), (q39 != \"No\") %>% replace_na(TRUE)) %>% droplevels()\n\n\nsave(bns_combined, file = here::here(\"./clean_data/bns_combined.Rdata\"))\nsave(bns, file = here::here(\"./clean_data/bns.Rdata\"))\nsave(BNSp2b, file = here::here(\"./clean_data/BNSp2b.Rdata\"))\n```\n:::\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}